var HeroMultirangeslider=function(t){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;for(var e=0,i=["webkit","moz"],s=window.requestAnimationFrame,a=0;a<i.length&&!window.requestAnimationFrame;++a)s=window[i[a]+"RequestAnimationFrame"];s||(s=function(t,i){var s=(new Date).getTime(),a=Math.max(0,16-(s-e)),n=window.setTimeout(function(){t(s+a)},a);return e=s+a,n});var n=s;class o{constructor(e){this.$el=t(e),this.$data={},this.$el.data("element",this)}draw(t){var e=this;return this.drawing?this.$el:(n(function(){e.drawing=!1,e.$el.css(t)}),this.drawing=!0,this.$el)}on(){return this.$el.on.apply(this.$el,arguments),this}one(){return this.$el.one.apply(this.$el,arguments),this}off(){return this.$el.off.apply(this.$el,arguments),this}trigger(){return this.$el.trigger.apply(this.$el,arguments),this}remove(){this.$el.remove()}detach(){this.$el.detach()}data(e,i){var s=e;if("string"==typeof e){if(void 0===i)return this.$data[e];(s={})[e]=i}return t.extend(this.$data,s),this}isVertical(){return this.options.vertical}ifVertical(t,e){return this.isVertical()?t:e}edge(t){if("start"===t)return this.ifVertical("top","left");if("end"===t)return this.ifVertical("bottom","right");throw new TypeError("What kind of an edge is "+t)}totalSize(){return this.$el[this.ifVertical("height","width")]()}edgeProp(t,e){return this.$el[e]()[this.edge(t)]}startProp(t){return this.edgeProp("start",t)}endProp(t){return this.edgeProp("end",t)}}class r extends o{constructor(e){super('<div class="hero-range"><span class="hero-range-label">');var i=this;this.options=e,this.perant=e.perant,this.options.rangeClass&&this.$el.addClass(this.options.rangeClass),this.readonly()?this.$el.addClass("hero-readonly"):(this.$el.prepend('<div class="hero-handle">').append('<div class="hero-handle">'),this.on("mouseenter.hero touchstart.hero",t.proxy(this.removePhantom,this)),this.on("mousedown.hero touchstart.hero",t.proxy(this.mousedown,this)),this.on("click",t.proxy(this.click,this))),"function"==typeof this.options.label?this.on("changing",function(e,s){i.writeLabel(i.options.label.call(i,s.map(t.proxy(i.perant.normalise,i.perant))))}):this.writeLabel(this.options.label),this.range=[],this.hasChanged=!1,this.options.value&&this.val(this.options.value)}writeLabel(t){this.$el.find(".hero-range-label")[this.options.htmlLabel?"html":"text"](t)}isVertical(){return this.perant.options.vertical}removePhantom(){this.perant.removePhantom()}readonly(){return"function"==typeof this.options.readonly?this.options.readonly.call(this.perant,this):this.options.readonly}val(e,i){if(void 0===e)return this.range;i=t.extend({},{dontApplyDelta:!1,trigger:!0},i||{});var s=this.perant.nextRange(this.$el),a=this.perant.prevRange(this.$el),n=e[1]-e[0],o=this;if(this.options.snap&&(e=e.map(p),n=p(n)),s&&s.val()[0]<=e[1]&&a&&a.val()[1]>=e[0]&&(e[1]=s.val()[0],e[0]=a.val()[1]),s&&s.val()[0]<e[1]&&(!this.perant.options.allowSwap||s.val()[1]>=e[0]?(e[1]=s.val()[0],i.dontApplyDelta||(e[0]=e[1]-n)):this.perant.repositionRange(this,e)),a&&a.val()[1]>e[0]&&(!this.perant.options.allowSwap||a.val()[0]<=e[1]?(e[0]=a.val()[1],i.dontApplyDelta||(e[1]=e[0]+n)):this.perant.repositionRange(this,e)),e[1]>=1&&(e[1]=1,i.dontApplyDelta||(e[0]=1-n)),e[0]<=0&&(e[0]=0,i.dontApplyDelta||(e[1]=n)),this.perant.options.bound){var r=this.perant.options.bound(this);r&&(r.upper&&e[1]>this.perant.abnormalise(r.upper)&&(e[1]=this.perant.abnormalise(r.upper),i.dontApplyDelta||(e[0]=e[1]-n)),r.lower&&e[0]<this.perant.abnormalise(r.lower)&&(e[0]=this.perant.abnormalise(r.lower),i.dontApplyDelta||(e[1]=e[0]+n)))}if(this.range[0]===e[0]&&this.range[1]===e[1])return this.$el;this.range=e,i.trigger&&(this.$el.triggerHandler("changing",[e,this.$el]),this.hasChanged=!0);var h=100*e[0]+"%",l=100*(e[1]-e[0])+"%";return this.draw(this.perant.options.vertical?{top:h,minHeight:l}:{left:h,minWidth:l}),this;function p(t){return Math.round(t/o.options.snap)*o.options.snap}}click(t){t.stopPropagation(),t.preventDefault();var e=this;2===t.which&&this.perant.options.allowDelete&&(this.deleteConfirm?(this.perant.removeRange(this),clearTimeout(this.deleteTimeout)):(this.$el.addClass("hero-delete-confirm"),this.deleteConfirm=!0,this.deleteTimeout=setTimeout(function(){e.$el.removeClass("hero-delete-confirm"),e.deleteConfirm=!1},this.perant.options.deleteTimeout)))}mousedown(e){if(e.stopPropagation(),e.preventDefault(),this.hasChanged=!1,!(e.which>1)){t(e.target).is(".hero-handle:first-child")?(t("body").addClass("hero-resizing").toggleClass("hero-resizing-vertical",this.isVertical()),t(document).on("mousemove.hero touchmove.hero",this.resizeStart(e))):t(e.target).is(".hero-handle:last-child")?(t("body").addClass("hero-resizing").toggleClass("hero-resizing-vertical",this.isVertical()),t(document).on("mousemove.hero touchmove.hero",this.resizeEnd(e))):(t("body").addClass("hero-dragging").toggleClass("hero-dragging-vertical",this.isVertical()),t(document).on("mousemove.hero touchmove.hero",this.drag(e)));var i=this;t(document).one("mouseup.hero touchend.hero",function(e){e.stopPropagation(),e.preventDefault(),i.hasChanged&&!i.swapping&&i.trigger("change",[i.range,i.$el]),i.swapping=!1,t(document).off("mouseup.hero mousemove.hero touchend.hero touchmove.hero"),t("body").removeClass("hero-resizing hero-dragging hero-resizing-vertical hero-dragging-vertical")})}}drag(t){var e=this,i=this.startProp("offset"),s=(this.startProp("position"),t[this.ifVertical("clientY","clientX")]),a=s?s-i:0,n=this.totalSize(),o=this.options.perant,r=o.startProp("offset"),h=o.totalSize();return function(t){t.stopPropagation(),t.preventDefault();var i=t[e.ifVertical("clientY","clientX")];if(void 0!==i){var s=i-r-a;if(s>=0&&s<=h-n){var o=s/h-e.range[0];e.val([s/h,e.range[1]+o])}else a=i-e.startProp("offset")}}}resizeEnd(e){var i=this,s=this.startProp("offset"),a=this.startProp("position"),n=(e[this.ifVertical("clientY","clientX")],this.totalSize(),this.options.perant),o=(n.startProp("offset"),n.totalSize()),r=this.options.minSize*o;return function(e){var n="touchmove"===e.type?"touchend":"mouseup",h="touchmove"===e.type?"touchstart":"mousedown";e.stopPropagation(),e.preventDefault();var l=e[i.ifVertical("clientY","clientX")],p=l-s;void 0!==l&&(p>o-a&&(p=o-a),p>=r?i.val([i.range[0],i.range[0]+p/o],{dontApplyDelta:!0}):p<=10&&(i.swapping=!0,t(document).trigger(n+".hero"),i.$el.find(".hero-handle:first-child").trigger(h+".hero")))}}resizeStart(e){var i=this,s=this.startProp("offset"),a=this.startProp("position"),n=e[this.ifVertical("clientY","clientX")],o=n?n-s:0,r=this.totalSize(),h=this.options.perant,l=h.startProp("offset"),p=h.totalSize(),d=this.options.minSize*p;return function(e){var s="touchmove"===e.type?"touchend":"mouseup",n="touchmove"===e.type?"touchstart":"mousedown";e.stopPropagation(),e.preventDefault();var h=e[i.ifVertical("clientY","clientX")],g=h-l-o,u=a+r-g;void 0!==h&&(g<0&&(g=0,u=a+r),u>=d?i.val([g/p,i.range[1]],{dontApplyDelta:!0}):u<=10&&(i.swapping=!0,t(document).trigger(s+".hero"),i.$el.find(".hero-handle:last-child").trigger(n+".hero")))}}}class h extends r{constructor(e){super(t.extend({readonly:!0,label:"+"},e)),this.$el.addClass("hero-phantom"),this.on("mousedown.hero touchstart.hero",t.proxy(this.mousedown,this))}mousedown(t){if(1===t.which){t.pageX;var e=this.options.perant.addRange(this.val());this.remove(),this.options.perant.trigger("addrange",[e.val(),e]),n(function(){e.$el.find(".hero-handle:first-child").trigger(t.type)})}}removePhantom(){}}class l extends o{constructor(t){super('<div class="hero-indicator">'),t.indicatorClass&&this.$el.addClass(t.indicatorClass),t.value&&this.val(t.value),this.options=t}val(t){return t&&(this.isVertical()?this.draw({top:100*t+"%"}):this.draw({left:100*t+"%"}),this.value=t),this.value}}class p extends o{constructor(t){super('<div class="hero-label">'),this.$el.css(t.perant.edge("start"),100*t.value+"%"),"function"==typeof t.label?this.$el.text(t.label.call(this,t.perant.normalise(t.value))):"string"==typeof t.label?this.$el.text(t.label):this.$el.text(t.perant.normalise(t.value))}}return class extends o{constructor(e){if(super('<div class="hero-rangebar">'),this.setup_options(e),this.options.min=this.options.valueParse(this.options.min),this.options.max=this.options.valueParse(this.options.max),this.options.barClass&&this.$el.addClass(this.options.barClass),this.options.vertical&&this.$el.addClass("hero-vertical"),this.ranges=[],this.on("mousemove.hero touchmove.hero",t.proxy(this.mousemove,this)),this.on("mouseleave.hero touchleave.hero",t.proxy(this.removePhantom,this)),e.values&&this.setVal(e.values),e.bgLabels&&(e.bgMark={count:e.bgLabels}),e.bgMark)if(this.$markContainer=t('<div class="hero-labels">').appendTo(this.$el),e.bgMark.count)for(var i=0;i<e.bgMark.count;++i)this.$markContainer.append(new p({label:e.bgMark.label,value:i/e.bgMark.count,perant:this}).$el);else if(e.bgMark.interval)for(i=this.abnormalise(this.options.min);i<this.abnormalise(this.options.max);i+=this.abnormalise(e.bgMark.interval))this.$markContainer.append(new p({label:e.bgMark.label,value:i,perant:this}).$el);var s=this;if(e.indicator){var a=this.indicator=new l({perant:this,vertical:this.options.vertical,indicatorClass:e.indicatorClass});a.val(this.abnormalise(e.indicator(this,a,function(){a.val(s.abnormalise(e.indicator(s,a)))}))),this.$el.append(a.$el)}}setup_options(t){const e={min:0,max:100,valueFormat:t=>t,valueParse:t=>t,maxRanges:1/0,readonly:!1,bgLabels:0,deleteTimeout:5e3,allowDelete:!1,vertical:!1,htmlLabel:!1,allowSwap:!0};this.options=Object.assign({},e,t)}normaliseRaw(t){return this.options.min+t*(this.options.max-this.options.min)}normalise(t){return this.options.valueFormat(this.normaliseRaw(t))}abnormaliseRaw(t){return(t-this.options.min)/(this.options.max-this.options.min)}abnormalise(t){return this.abnormaliseRaw(this.options.valueParse(t))}findGap(t){var e=0;return this.ranges.forEach(function(i,s){i.val()[0]<t[0]&&i.val()[1]<t[1]&&(e=s+1)}),e}insertRangeIndex(t,e,i){i||this.ranges.splice(e,0,t),this.ranges[e-1]?this.ranges[e-1].$el.after(t.$el):this.$el.prepend(t.$el)}addRange(t,e){var i=new r({perant:this,snap:this.options.snap?this.abnormaliseRaw(this.options.snap+this.options.min):null,label:this.options.label,rangeClass:this.options.rangeClass,minSize:this.options.minSize?this.abnormaliseRaw(this.options.minSize+this.options.min):null,readonly:this.options.readonly,htmlLabel:this.options.htmlLabel});this.options.data&&i.data(this.options.data.call(i,this)),e&&i.data(e),this.insertRangeIndex(i,this.findGap(t)),i.val(t);var s=this;return i.on("changing",function(t,e,i){t.stopPropagation(),s.trigger("changing",[s.val(),i])}).on("change",function(t,e,i){t.stopPropagation(),s.trigger("change",[s.val(),i])}),i}prevRange(t){var e=t.index();if(e>=0)return this.ranges[e-1]}nextRange(t){var e=t.index();if(e>=0)return this.ranges[t instanceof h?e:e+1]}setVal(e){if(this.ranges.length>e.length){for(var i=e.length-1,s=this.ranges.length-1;i<s;--s)this.removeRange(i);this.ranges.length=e.length}var a=this;return e.forEach(function(e,i){a.ranges[i]?a.ranges[i].val(e.map(t.proxy(a.abnormalise,a))):a.addRange(e.map(t.proxy(a.abnormalise,a)))}),this}val(e){var i=this;return void 0===e?this.ranges.map(function(e){return e.val().map(t.proxy(i.normalise,i))}):(this.readonly()||this.setVal(e),this)}removePhantom(){this.phantom&&(this.phantom.remove(),this.phantom=null)}removeRange(t,e,i){t instanceof r&&(t=this.ranges.indexOf(t)),this.ranges.splice(t,1)[0][i?"detach":"remove"](),e||this.trigger("change",[this.val()])}repositionRange(t,e){this.removeRange(t,!0,!0),this.insertRangeIndex(t,this.findGap(e))}calcGap(t){var e=this.ranges[t-1]?this.ranges[t-1].val()[1]:0,i=this.ranges[t]?this.ranges[t].val()[0]:1;return this.normaliseRaw(i)-this.normaliseRaw(e)}readonly(){return"function"==typeof this.options.readonly?this.options.readonly.call(this):this.options.readonly}mousemove(e){var i=this.options.minSize?this.abnormaliseRaw(this.options.minSize+this.options.min):.05,s=(event[this.ifVertical("pageY","pageX")]-this.startProp("offset"))/this.totalSize()-i/2,a=e.target===e.currentTarget,n=t(e.target).is(".hero-phantom");if((a||n)&&this.ranges.length<this.options.maxRanges&&!t("body").is(".hero-dragging, .hero-resizing")&&!this.readonly()){this.phantom||(this.phantom=new h({perant:this,snap:this.options.snap?this.abnormaliseRaw(this.options.snap+this.options.min):null,label:"+",minSize:this.options.minSize?this.abnormaliseRaw(this.options.minSize+this.options.min):null,rangeClass:this.options.rangeClass}));var o=this.findGap([s,s+i]),r=this;this.one("addrange",function(t,e,i){i.one("mouseup",function(){r.trigger("change",[r.val(),i])})}),(!this.options.minSize||this.calcGap(o)>=this.options.minSize)&&(this.insertRangeIndex(this.phantom,o,!0),this.phantom.val([s,s+i],{trigger:!1}))}}}}($);
